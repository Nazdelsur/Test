<!DOCTYPE html>
<html lang="en">

<head>
    <title>HIBERUS Copilot Web Chat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
    <script type="text/javascript" src="https://alcdn.msauth.net/browser/2.32.0/js/msal-browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Barlow&display=swap" rel="stylesheet">
</head>

<body>
    <div id="chatwindow">
        <div id="header">
            <img src="igris_bot_icon_128x128.png" alt="IGRIS LOGO" style="height: 32px; margin-right: 10px;" />
            <span style="font-size: 24px; font-weight: bold; color: #e60000">HIBERUS Web Chat</span>
        </div>

        <div id="subheader">
            <span id="loginStatus">You are not logged in on the website.</span>
            <button id="login" onclick="onSignInClick()">Log in</button>
            <button id="logout" onclick="onSignOutClick()" style="display:none">Log out</button>
        </div>

        <div id="webchat"></div>
    </div>

    <script>
        // Inserta el CSS avanzado dinámicamente como const funcional
        const styleSheet = `
            .android-expanded { background-color: rgba(255, 255, 255, 1.0); display: flex; flex-direction: row; justify-content: center; width: 100%; }
            .android-expanded .div { background: linear-gradient(180deg, rgba(179, 179, 179, 0.62) 0%, rgba(111, 109, 109, 0.2) 100%), url(./MS-YP-wallpaper-desktop-1.png) center/cover no-repeat; height: 800px; position: relative; width: 1280px; }
            .android-expanded .image { height: 504px; left: 25px; object-fit: cover; position: absolute; top: 88px; width: 750px; }
            .android-expanded .button { all: unset; align-items: flex-start; border-radius: 15px; box-sizing: border-box; display: inline-flex; flex-direction: column; gap: 8px; height: 34px; left: 802px; overflow: hidden; position: absolute; top: 25px; }
            .android-expanded .distort { height: 34px; left: 0; object-fit: cover; position: absolute; top: 0; width: 158px; }
            .android-expanded .liquid-glass-button { -webkit-backdrop-filter: blur(12px) brightness(100%); backdrop-filter: blur(12px) brightness(100%); background: linear-gradient(180deg, rgba(102, 102, 102, 0.2) 0%, rgba(102, 102, 102, 0) 33%), linear-gradient(180deg, rgba(102, 102, 102, 0) 50%, rgba(102, 102, 102, 0.2) 100%), linear-gradient(0deg, rgba(29, 29, 29, 0.2) 0%, rgba(29, 29, 29, 0.2) 100%), linear-gradient(0deg, rgba(29, 29, 29, 1) 0%, rgba(29, 29, 29, 1) 100%); border: none; border-left: 2px solid; border-top: 2px solid; border-radius: 32px; box-shadow: inset 0px 0px 22px #f2f2f280, inset 2px 2px 1px -2px #b3b3b3, inset -5px -12px 6px -14px #b3b3b3; display: flex; flex: 1; flex-grow: 1; gap: 8px; justify-content: center; margin: -1px; overflow: hidden; padding: 12px 24px; position: relative; width: 100%; }
            .android-expanded .liquid-glass-button::before { -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; background: linear-gradient(148deg, rgba(255, 255, 255, 1) 0%, rgba(255, 255, 255, 0) 50%); border-radius: 32px; content: ""; inset: 0; mask-composite: exclude; padding: 2px; pointer-events: none; position: absolute; z-index: 1; }
            .android-expanded .text-wrapper { color: #ffffff; font-family: "SF Pro-Semibold", Helvetica; font-size: 15px; font-weight: 400; line-height: 15px; position: relative; text-align: center; white-space: nowrap; width: fit-content; }
            /* Puedes continuar agregando aquí todo el resto de tu CSS recortado según necesidad */
        `;

        const styleTag = document.createElement('style');
        styleTag.innerHTML = styleSheet;
        document.head.appendChild(styleTag);

        // Configuraciones de tu bot
        const clientId = "4b2315fa-fd7b-4bcf-9ea0-283a5b877e11";
        const tenantId = "959d9200-12be-4937-9ff4-a42df3cd2427";
        const tokenEndpoint = "https://2e3fb5a32998ed9fad7d8ee9e845db.49.environment.api.powerplatform.com/powervirtualagents/botsbyschema/iaghm_iagEmploymentHistoryReader/directline/token?api-version=2022-03-01-preview";

        const msalConfig = {
            auth: { clientId: clientId, authority: "https://login.microsoftonline.com/" + tenantId },
            cache: { cacheLocation: "sessionStorage", storeAuthStateInCookie: false }
        };

        const loginRequest = { scopes: ["User.Read", "openid", "profile"] };
        const msalInstance = new msal.PublicClientApplication(msalConfig);

        const styleOptions = {
            botAvatarImage: 'igris_bot_icon_128x128.png',
            botAvatarBackgroundColor: 'transparent',
            userAvatarImage: 'Icon_mini.png',
            userAvatarBackgroundColor: 'transparent',
            bubbleBackground: 'transparent',
            bubbleFromUserBackground: 'transparent',
            bubbleBorderRadius: 12,
            bubbleFromUserBorderRadius: 12,
            hideUploadButton: false,
            sendBoxBackground: '#e0e0e0',
            sendBoxBorderTop: 'solid 2px #ccc',
            sendBoxTextColor: '#000',
            primaryFont: "'BaikalBlack', sans-serif",
            accent: '#e60000'
        };

        async function fetchJSON(url, options = {}) {
            const res = await fetch(url, { ...options, headers: { ...options.headers, accept: 'application/json' } });
            if (!res.ok) throw new Error(`Failed to fetch JSON due to ${res.status}`);
            return await res.json();
        }

        async function renderChatWidget() {
            const { token } = await fetchJSON(tokenEndpoint);
            const directLine = window.WebChat.createDirectLine({ token });
            window.WebChat.renderWebChat({
                directLine,
                styleOptions,
                userID: "user_" + Date.now()
            }, document.getElementById('webchat'));
        }

        (async () => { await renderChatWidget(); })();
    </script>
</body>

</html>
